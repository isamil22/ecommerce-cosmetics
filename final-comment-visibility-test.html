<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Comment Visibility Control Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        .content {
            padding: 40px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            background: #f8f9fa;
        }
        .test-section h2 {
            color: #2c3e50;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-section h2::before {
            content: "üß™";
            font-size: 1.5rem;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
            text-decoration: none;
            display: inline-block;
            width: 100%;
            text-align: center;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .test-button.success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        .test-button.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        .test-button.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        .test-button.info {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
            border-left: 4px solid;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }
        .console-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            white-space: pre-wrap;
        }
        .step {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
        }
        .step h3 {
            margin-top: 0;
            color: #007bff;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }
        .test-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .result-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e1e5e9;
            text-align: center;
        }
        .result-card h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        .result-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .link-button {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 15px;
            border-radius: 10px;
            text-decoration: none;
            color: #495057;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
        }
        .link-button:hover {
            background: #e9ecef;
            border-color: #adb5bd;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéõÔ∏è Final Comment Visibility Control Test</h1>
            <p>Comprehensive verification of the admin comment control feature</p>
        </div>
        
        <div class="content">
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div style="text-align: center; margin-bottom: 20px;">
                <span id="progressText">Ready to start testing...</span>
            </div>

            <!-- Server Status -->
            <div class="test-section">
                <h2>Server Status Check</h2>
                <div class="links">
                    <a href="http://localhost:8081" class="link-button" target="_blank">
                        üåê Frontend (Port 8081)
                    </a>
                    <a href="http://localhost:8080/api/packs/1" class="link-button" target="_blank">
                        üîå Backend API (Port 8080)
                    </a>
                    <a href="http://localhost:8081/admin/packs/new" class="link-button" target="_blank">
                        üìù Admin Pack Form
                    </a>
                    <a href="http://localhost:8081/packs/1" class="link-button" target="_blank">
                        üì¶ Test Pack Page
                    </a>
                </div>
                <button class="test-button info" onclick="checkServerStatus()">
                    üîç Check Server Status
                </button>
            </div>

            <!-- Test 1: Admin Form Test -->
            <div class="test-section">
                <h2>Test 1: Admin Pack Form Comment Control</h2>
                <div class="step">
                    <h3>üìù Verify Comment Control Exists</h3>
                    <p>Check if the comment visibility control is properly implemented in the admin pack form.</p>
                    <button class="test-button" onclick="testAdminForm()">
                        üß™ Test Admin Form
                    </button>
                </div>
                <div id="adminFormResults"></div>
            </div>

            <!-- Test 2: API Response Test -->
            <div class="test-section">
                <h2>Test 2: API Response Verification</h2>
                <div class="step">
                    <h3>üîå Check Backend Integration</h3>
                    <p>Verify that the API returns the commentsEnabled field in pack responses.</p>
                    <button class="test-button success" onclick="testAPIResponse()">
                        üîç Test API Response
                    </button>
                </div>
                <div id="apiResults"></div>
            </div>

            <!-- Test 3: Pack Creation Test -->
            <div class="test-section">
                <h2>Test 3: Pack Creation with Comments</h2>
                <div class="step">
                    <h3>üì¶ Create Test Packs</h3>
                    <p>Create packs with different comment visibility settings to test the functionality.</p>
                    <button class="test-button warning" onclick="createPackWithComments()">
                        ‚úÖ Create Pack with Comments
                    </button>
                    <button class="test-button danger" onclick="createPackWithoutComments()">
                        ‚ùå Create Pack without Comments
                    </button>
                </div>
                <div id="creationResults"></div>
            </div>

            <!-- Test 4: Pack Page Verification -->
            <div class="test-section">
                <h2>Test 4: Pack Page Comment Display</h2>
                <div class="step">
                    <h3>üëÄ Verify Comment Section Display</h3>
                    <p>Check that comment sections are shown or hidden based on the pack settings.</p>
                    <button class="test-button info" onclick="testPackPageDisplay()">
                        üîç Test Pack Page Display
                    </button>
                </div>
                <div id="displayResults"></div>
            </div>

            <!-- Test Results Summary -->
            <div class="test-section">
                <h2>Test Results Summary</h2>
                <div class="test-results">
                    <div class="result-card">
                        <div class="result-icon" id="serverIcon">‚è≥</div>
                        <h4>Server Status</h4>
                        <p id="serverStatus">Not tested</p>
                    </div>
                    <div class="result-card">
                        <div class="result-icon" id="adminIcon">‚è≥</div>
                        <h4>Admin Form</h4>
                        <p id="adminStatus">Not tested</p>
                    </div>
                    <div class="result-card">
                        <div class="result-icon" id="apiIcon">‚è≥</div>
                        <h4>API Response</h4>
                        <p id="apiStatus">Not tested</p>
                    </div>
                    <div class="result-card">
                        <div class="result-icon" id="displayIcon">‚è≥</div>
                        <h4>Page Display</h4>
                        <p id="displayStatus">Not tested</p>
                    </div>
                </div>
                <button class="test-button success" onclick="runAllTests()">
                    üöÄ Run Complete Test Suite
                </button>
            </div>

            <!-- Console Output -->
            <div class="test-section">
                <h2>Test Console Output</h2>
                <div id="consoleOutput" class="console-output">Waiting for test execution...\n</div>
                <button class="test-button" onclick="clearConsole()">
                    üóëÔ∏è Clear Console
                </button>
            </div>
        </div>
    </div>

    <script>
        let testResults = {
            server: 'pending',
            adminForm: 'pending',
            apiResponse: 'pending',
            packDisplay: 'pending'
        };
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            const consoleOutput = document.getElementById('consoleOutput');
            consoleOutput.textContent += logMessage + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            console.log(logMessage);
        }

        function updateProgress() {
            const totalTests = 4;
            const completedTests = Object.values(testResults).filter(status => status === 'completed').length;
            const progress = (completedTests / totalTests) * 100;
            
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Progress: ${completedTests}/${totalTests} tests completed (${Math.round(progress)}%)`;
        }

        function updateResultCard(testName, status, message) {
            const iconMap = {
                'pending': '‚è≥',
                'completed': '‚úÖ',
                'failed': '‚ùå',
                'testing': 'üß™'
            };
            
            const statusMap = {
                'pending': 'Not tested',
                'completed': 'Passed',
                'failed': 'Failed',
                'testing': 'Testing...'
            };
            
            document.getElementById(`${testName}Icon`).textContent = iconMap[status];
            document.getElementById(`${testName}Status`).textContent = statusMap[status];
            
            if (message) {
                log(`${testName}: ${message}`, status === 'completed' ? 'success' : 'error');
            }
            
            updateProgress();
        }

        async function checkServerStatus() {
            log('üîç Checking server status...', 'info');
            updateResultCard('server', 'testing');
            
            try {
                // Check frontend
                const frontendResponse = await fetch('http://localhost:8081');
                if (frontendResponse.ok) {
                    log('‚úÖ Frontend server is running on port 8081', 'success');
                } else {
                    log('‚ùå Frontend server not responding', 'error');
                }
            } catch (error) {
                log('‚ùå Frontend server not accessible: ' + error.message, 'error');
            }
            
            try {
                // Check backend
                const backendResponse = await fetch('http://localhost:8080/api/packs/1');
                if (backendResponse.ok) {
                    const data = await backendResponse.json();
                    log('‚úÖ Backend server is running on port 8080', 'success');
                    
                    // Check if commentsEnabled field exists
                    if (data.data && typeof data.data.commentsEnabled !== 'undefined') {
                        log(`‚úÖ API returns commentsEnabled field: ${data.data.commentsEnabled}`, 'success');
                        testResults.server = 'completed';
                        updateResultCard('server', 'completed', 'Both servers running, API field present');
                    } else {
                        log('‚ö†Ô∏è API does not return commentsEnabled field', 'warning');
                        testResults.server = 'failed';
                        updateResultCard('server', 'failed', 'Servers running but API field missing');
                    }
                } else {
                    log('‚ùå Backend server not responding', 'error');
                    testResults.server = 'failed';
                    updateResultCard('server', 'failed', 'Backend server not responding');
                }
            } catch (error) {
                log('‚ùå Backend server not accessible: ' + error.message, 'error');
                testResults.server = 'failed';
                updateResultCard('server', 'failed', 'Backend server not accessible');
            }
        }

        async function testAdminForm() {
            log('üß™ Testing admin pack form...', 'info');
            updateResultCard('adminForm', 'testing');
            
            try {
                // Open admin form in new tab
                const newWindow = window.open('http://localhost:8081/admin/packs/new', '_blank');
                
                setTimeout(() => {
                    log('‚úÖ Admin form opened in new tab', 'success');
                    log('Please verify the following in the new tab:', 'info');
                    log('1. Look for "Comment Section" control in Basic Information', 'info');
                    log('2. Check for radio buttons: "Show Comments" ‚úì and "Hide Comments" ‚úó', 'info');
                    log('3. Verify "Show Comments" is selected by default', 'info');
                    log('4. Test toggling between the options', 'info');
                    
                    testResults.adminForm = 'completed';
                    updateResultCard('adminForm', 'completed', 'Form opened successfully');
                }, 1000);
                
            } catch (error) {
                log('‚ùå Error opening admin form: ' + error.message, 'error');
                testResults.adminForm = 'failed';
                updateResultCard('adminForm', 'failed', 'Failed to open admin form');
            }
        }

        async function testAPIResponse() {
            log('üîå Testing API response...', 'info');
            updateResultCard('apiResponse', 'testing');
            
            try {
                const response = await fetch('http://localhost:8080/api/packs/1');
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.data && typeof data.data.commentsEnabled !== 'undefined') {
                        log(`‚úÖ API returns commentsEnabled field: ${data.data.commentsEnabled}`, 'success');
                        testResults.apiResponse = 'completed';
                        updateResultCard('apiResponse', 'completed', 'API field present');
                    } else {
                        log('‚ùå API does not return commentsEnabled field', 'error');
                        testResults.apiResponse = 'failed';
                        updateResultCard('apiResponse', 'failed', 'API field missing');
                    }
                } else {
                    log(`‚ùå API request failed: ${response.status}`, 'error');
                    testResults.apiResponse = 'failed';
                    updateResultCard('apiResponse', 'failed', 'API request failed');
                }
            } catch (error) {
                log('‚ùå Error testing API: ' + error.message, 'error');
                testResults.apiResponse = 'failed';
                updateResultCard('apiResponse', 'failed', 'API error');
            }
        }

        async function createPackWithComments() {
            log('üì¶ Creating pack with comments enabled...', 'info');
            
            try {
                const newWindow = window.open('http://localhost:8081/admin/packs/new', '_blank');
                
                setTimeout(() => {
                    log('‚úÖ Admin form opened for creating pack with comments', 'success');
                    log('Please follow these steps:', 'info');
                    log('1. Fill in pack name: "Test Pack with Comments"', 'info');
                    log('2. Set price: $29.99', 'info');
                    log('3. Ensure "Show Comments" is selected', 'info');
                    log('4. Submit the form', 'info');
                    log('5. Note the created pack ID', 'info');
                }, 1000);
                
            } catch (error) {
                log('‚ùå Error opening admin form: ' + error.message, 'error');
            }
        }

        async function createPackWithoutComments() {
            log('üö´ Creating pack with comments disabled...', 'info');
            
            try {
                const newWindow = window.open('http://localhost:8081/admin/packs/new', '_blank');
                
                setTimeout(() => {
                    log('‚úÖ Admin form opened for creating pack without comments', 'success');
                    log('Please follow these steps:', 'info');
                    log('1. Fill in pack name: "Test Pack without Comments"', 'info');
                    log('2. Set price: $39.99', 'info');
                    log('3. Select "Hide Comments" ‚úó', 'info');
                    log('4. Submit the form', 'info');
                    log('5. Note the created pack ID', 'info');
                }, 1000);
                
            } catch (error) {
                log('‚ùå Error opening admin form: ' + error.message, 'error');
            }
        }

        async function testPackPageDisplay() {
            log('üëÄ Testing pack page display...', 'info');
            updateResultCard('display', 'testing');
            
            try {
                const newWindow = window.open('http://localhost:8081/packs/1', '_blank');
                
                setTimeout(() => {
                    log('‚úÖ Pack page opened in new tab', 'success');
                    log('Please verify the following in the new tab:', 'info');
                    log('1. Scroll down to look for comments section', 'info');
                    log('2. If comments are enabled: Look for "üí¨ ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™ / Comments" header', 'info');
                    log('3. If comments are disabled: No comments section should be visible', 'info');
                    log('4. Page should end with recommendations section', 'info');
                    
                    testResults.packDisplay = 'completed';
                    updateResultCard('display', 'completed', 'Page opened for verification');
                }, 1000);
                
            } catch (error) {
                log('‚ùå Error opening pack page: ' + error.message, 'error');
                testResults.packDisplay = 'failed';
                updateResultCard('display', 'failed', 'Failed to open pack page');
            }
        }

        async function runAllTests() {
            log('üöÄ Running complete test suite...', 'info');
            
            // Clear previous results
            testResults = {
                server: 'pending',
                adminForm: 'pending',
                apiResponse: 'pending',
                packDisplay: 'pending'
            };
            
            document.getElementById('consoleOutput').textContent = '';
            
            // Run tests in sequence
            await checkServerStatus();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testAPIResponse();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testAdminForm();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testPackPageDisplay();
            
            log('üéØ Complete test suite finished', 'success');
            log('Please manually verify the opened tabs and complete the testing process', 'info');
        }

        function clearConsole() {
            document.getElementById('consoleOutput').textContent = '';
            log('Console cleared', 'info');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('üéõÔ∏è Final Comment Visibility Control Test Page Loaded', 'success');
            log('This test will verify the admin comment control feature', 'info');
            log('Make sure both frontend (port 8081) and backend (port 8080) are running', 'info');
            updateProgress();
        });
    </script>
</body>
</html>
