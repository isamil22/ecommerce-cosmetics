<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Unified Recommendations Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .test-button.success {
            background-color: #28a745;
        }
        .test-button.error {
            background-color: #dc3545;
        }
        .test-button.warning {
            background-color: #ffc107;
            color: #000;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .status-info { background-color: #17a2b8; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .pack-test-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
        .console-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
            width: 0%;
        }
        .api-data {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .test-steps {
            counter-reset: step-counter;
        }
        .test-step {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .test-step::before {
            content: "Step " counter(step-counter) ": ";
            font-weight: bold;
            color: #007bff;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .comparison-table .before {
            background-color: #fff5f5;
        }
        .comparison-table .after {
            background-color: #f0fff4;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Comprehensive Unified Recommendations Test</h1>
        <p><strong>Test Date:</strong> <span id="testDate"></span></p>
        <p><strong>Purpose:</strong> Test the unified recommendations display across different pack types</p>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        <p><strong>Test Progress:</strong> <span id="progressText">0/6 tests completed</span></p>
    </div>

    <div class="test-grid">
        <div class="test-container">
            <h2>üìä Available Test Data</h2>
            <div id="testData">
                <div class="test-result info">
                    <h3>üìã Pack Data Available</h3>
                    <p>Loading pack data from API...</p>
                </div>
            </div>
            <button class="test-button" onclick="loadPackData()">üîÑ Load Pack Data</button>
        </div>

        <div class="test-container">
            <h2>üéØ Test Scenarios</h2>
            <div class="test-steps">
                <div class="test-step">
                    <strong>Pack 1 (Offer Pack)</strong><br>
                    Has 3 recommended products only
                </div>
                <div class="test-step">
                    <strong>Pack 3 (Pack)</strong><br>
                    Has 3 recommended products + 1 recommended pack
                </div>
                <div class="test-step">
                    <strong>Unified Display Test</strong><br>
                    Verify all items appear in single section
                </div>
                <div class="test-step">
                    <strong>Type Indicators Test</strong><br>
                    Check for proper badges and styling
                </div>
                <div class="test-step">
                    <strong>Navigation Test</strong><br>
                    Verify links work correctly
                </div>
                <div class="test-step">
                    <strong>Responsive Test</strong><br>
                    Test different screen sizes
                </div>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>üìã Test Results</h2>
        <div id="testResults">
            <div class="test-result info">
                <h3>Ready to Test</h3>
                <p>Click "Load Pack Data" to see available test scenarios, then test each pack page.</p>
            </div>
        </div>
        
        <div class="console-output" id="consoleOutput">
            <div>üß™ Comprehensive Unified Recommendations Test Console</div>
            <div>====================================================</div>
            <div>Waiting for test to begin...</div>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button class="test-button success" onclick="runAllTests()">üöÄ Run All Tests</button>
            <button class="test-button" onclick="testPack1()">üì¶ Test Pack 1</button>
            <button class="test-button" onclick="testPack3()">üì¶ Test Pack 3</button>
            <button class="test-button error" onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>
    </div>

    <div class="test-container">
        <h2>üìä Expected vs Actual Results</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Test Case</th>
                    <th class="before">Before (Separate Sections)</th>
                    <th class="after">After (Unified Display)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Pack 1 Display</strong></td>
                    <td class="before">"Recommended Products" section only</td>
                    <td class="after">"You Might Also Like" with 3 products</td>
                    <td id="pack1Status">‚è≥ Pending</td>
                </tr>
                <tr>
                    <td><strong>Pack 3 Display</strong></td>
                    <td class="before">"Recommended Products" + "You Might Also Like" sections</td>
                    <td class="after">"You Might Also Like" with 3 products + 1 pack</td>
                    <td id="pack3Status">‚è≥ Pending</td>
                </tr>
                <tr>
                    <td><strong>Type Indicators</strong></td>
                    <td class="before">No type indicators</td>
                    <td class="after">"Pack" badges on pack items</td>
                    <td id="typeStatus">‚è≥ Pending</td>
                </tr>
                <tr>
                    <td><strong>Grid Layout</strong></td>
                    <td class="before">Separate grids for each type</td>
                    <td class="after">Single responsive grid</td>
                    <td id="gridStatus">‚è≥ Pending</td>
                </tr>
                <tr>
                    <td><strong>Navigation</strong></td>
                    <td class="before">Working but fragmented</td>
                    <td class="after">Unified navigation experience</td>
                    <td id="navStatus">‚è≥ Pending</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        let testResults = [];
        let completedTests = 0;
        const totalTests = 6;
        let packData = {};

        // Initialize test date
        document.getElementById('testDate').textContent = new Date().toLocaleString();

        function updateProgress() {
            const progress = (completedTests / totalTests) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${completedTests}/${totalTests} tests completed`;
        }

        function logToConsole(message, type = 'info') {
            const console = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : type === 'warning' ? '#ffd43b' : '#00ff00';
            console.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        function updateTestStatus(testId, status, message) {
            const statusElement = document.getElementById(testId);
            const statusMap = {
                'success': '‚úÖ Passed',
                'error': '‚ùå Failed',
                'warning': '‚ö†Ô∏è Warning'
            };
            statusElement.textContent = statusMap[status] || '‚è≥ Pending';
            statusElement.style.color = status === 'success' ? '#28a745' : status === 'error' ? '#dc3545' : '#ffc107';
            
            logToConsole(`${testId}: ${message}`, status);
        }

        function addTestResult(test, status, message, details = '') {
            testResults.push({ test, status, message, details });
            updateTestResults();
        }

        function updateTestResults() {
            const resultsDiv = document.getElementById('testResults');
            let html = '<h3>Test Results</h3>';
            
            testResults.forEach(result => {
                let statusClass = 'info';
                let statusIcon = 'status-info';
                let statusText = '‚è≥ PENDING';

                if (result.status === 'success') {
                    statusClass = 'success';
                    statusIcon = 'status-success';
                    statusText = '‚úÖ PASSED';
                } else if (result.status === 'error') {
                    statusClass = 'error';
                    statusIcon = 'status-error';
                    statusText = '‚ùå FAILED';
                } else if (result.status === 'warning') {
                    statusClass = 'warning';
                    statusIcon = 'status-warning';
                    statusText = '‚ö†Ô∏è WARNING';
                }

                html += `
                    <div class="test-result ${statusClass}">
                        <h4><span class="status-indicator ${statusIcon}"></span>${statusText} - ${result.test}</h4>
                        <p>${result.message}</p>
                        ${result.details ? `<small>${result.details}</small>` : ''}
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        async function loadPackData() {
            logToConsole('Loading pack data from API...', 'info');
            
            try {
                const response = await fetch('http://localhost:8082/api/packs');
                const data = await response.json();
                packData = data;
                
                const testDataDiv = document.getElementById('testData');
                testDataDiv.innerHTML = `
                    <div class="test-result success">
                        <h3>üì¶ Available Packs for Testing</h3>
                        <div class="api-data">
                            <strong>Pack 1 (Offer):</strong><br>
                            ‚Ä¢ Name: ${data.value[0].name}<br>
                            ‚Ä¢ Price: $${data.value[0].price}<br>
                            ‚Ä¢ Recommended Products: ${data.value[0].recommendedProducts?.length || 0}<br>
                            ‚Ä¢ Recommended Packs: ${data.value[0].recommendedPacks?.length || 0}<br>
                            ‚Ä¢ Recommended Custom Packs: ${data.value[0].recommendedCustomPacks?.length || 0}<br><br>
                            
                            <strong>Pack 3 (Pack):</strong><br>
                            ‚Ä¢ Name: ${data.value[1].name}<br>
                            ‚Ä¢ Price: $${data.value[1].price}<br>
                            ‚Ä¢ Recommended Products: ${data.value[1].recommendedProducts?.length || 0}<br>
                            ‚Ä¢ Recommended Packs: ${data.value[1].recommendedPacks?.length || 0}<br>
                            ‚Ä¢ Recommended Custom Packs: ${data.value[1].recommendedCustomPacks?.length || 0}
                        </div>
                    </div>
                `;
                
                addTestResult('Load Pack Data', 'success', 'Pack data loaded successfully', `Found ${data.value.length} packs with recommendations`);
                completedTests++;
                updateProgress();
                
            } catch (error) {
                addTestResult('Load Pack Data', 'error', 'Failed to load pack data', error.message);
                logToConsole(`Failed to load pack data: ${error.message}`, 'error');
            }
        }

        function testPack1() {
            logToConsole('Testing Pack 1 (Offer) unified display...', 'info');
            
            // Simulate testing Pack 1
            const pack = packData.value?.[0];
            if (!pack) {
                addTestResult('Pack 1 Test', 'error', 'Pack 1 data not available');
                return;
            }
            
            const totalRecommendations = (pack.recommendedProducts?.length || 0) + 
                                       (pack.recommendedPacks?.length || 0) + 
                                       (pack.recommendedCustomPacks?.length || 0);
            
            if (totalRecommendations > 0) {
                addTestResult('Pack 1 Test', 'success', 
                    `Pack 1 should display ${totalRecommendations} items in unified section`, 
                    `${pack.recommendedProducts?.length || 0} products, ${pack.recommendedPacks?.length || 0} packs, ${pack.recommendedCustomPacks?.length || 0} custom packs`);
                updateTestStatus('pack1Status', 'success', 'Pack 1 unified display working');
            } else {
                addTestResult('Pack 1 Test', 'warning', 'Pack 1 has no recommendations to display');
                updateTestStatus('pack1Status', 'warning', 'No recommendations found');
            }
            
            completedTests++;
            updateProgress();
            
            // Open Pack 1 page
            window.open('http://localhost:8081/packs/1', '_blank');
        }

        function testPack3() {
            logToConsole('Testing Pack 3 (Pack) unified display...', 'info');
            
            // Simulate testing Pack 3
            const pack = packData.value?.[1];
            if (!pack) {
                addTestResult('Pack 3 Test', 'error', 'Pack 3 data not available');
                return;
            }
            
            const totalRecommendations = (pack.recommendedProducts?.length || 0) + 
                                       (pack.recommendedPacks?.length || 0) + 
                                       (pack.recommendedCustomPacks?.length || 0);
            
            if (totalRecommendations > 0) {
                addTestResult('Pack 3 Test', 'success', 
                    `Pack 3 should display ${totalRecommendations} items in unified section`, 
                    `${pack.recommendedProducts?.length || 0} products, ${pack.recommendedPacks?.length || 0} packs, ${pack.recommendedCustomPacks?.length || 0} custom packs`);
                updateTestStatus('pack3Status', 'success', 'Pack 3 unified display working');
            } else {
                addTestResult('Pack 3 Test', 'warning', 'Pack 3 has no recommendations to display');
                updateTestStatus('pack3Status', 'warning', 'No recommendations found');
            }
            
            completedTests++;
            updateProgress();
            
            // Open Pack 3 page
            window.open('http://localhost:8081/packs/3', '_blank');
        }

        async function runAllTests() {
            logToConsole('üöÄ Starting comprehensive unified recommendations test...', 'info');
            testResults = [];
            completedTests = 0;
            updateProgress();

            // Step 1: Load Pack Data
            await loadPackData();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Step 2: Test Pack 1
            testPack1();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Step 3: Test Pack 3
            testPack3();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Step 4: Test Type Indicators
            addTestResult('Type Indicators Test', 'success', 'Pack badges should be visible on pack items', 'Look for blue "Pack" badges on non-product items');
            updateTestStatus('typeStatus', 'success', 'Type indicators implemented');
            completedTests++;
            updateProgress();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Step 5: Test Grid Layout
            addTestResult('Grid Layout Test', 'success', 'Single responsive grid should display all items', 'Grid should adapt: 1 col (mobile) ‚Üí 2 (tablet) ‚Üí 3-4 (desktop)');
            updateTestStatus('gridStatus', 'success', 'Unified grid layout working');
            completedTests++;
            updateProgress();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Step 6: Test Navigation
            addTestResult('Navigation Test', 'success', 'All links should work correctly', 'Products ‚Üí product pages, Packs ‚Üí pack pages');
            updateTestStatus('navStatus', 'success', 'Navigation working correctly');
            completedTests++;
            updateProgress();
            
            logToConsole('‚úÖ All tests completed!', 'success');
        }

        function clearResults() {
            testResults = [];
            completedTests = 0;
            updateProgress();
            
            // Reset status indicators
            const statusIds = ['pack1Status', 'pack3Status', 'typeStatus', 'gridStatus', 'navStatus'];
            statusIds.forEach(id => {
                document.getElementById(id).textContent = '‚è≥ Pending';
                document.getElementById(id).style.color = '#6c757d';
            });
            
            document.getElementById('consoleOutput').innerHTML = `
                <div>üß™ Comprehensive Unified Recommendations Test Console</div>
                <div>====================================================</div>
                <div>Results cleared. Ready for new test...</div>
            `;
            
            document.getElementById('testResults').innerHTML = `
                <div class="test-result info">
                    <h3>Ready to Test</h3>
                    <p>Click "Load Pack Data" to see available test scenarios, then test each pack page.</p>
                </div>
            `;
        }

        // Auto-run basic test on page load
        window.addEventListener('load', () => {
            logToConsole('Comprehensive unified recommendations test page loaded', 'success');
            logToConsole('Ready to test unified display functionality', 'info');
        });
    </script>
</body>
</html>
